"""
æƒ…ç»ªæ˜ å°„æ¨¡å‹
åŸºäºREADME_EMOTION.mdçš„å®Œæ•´æƒ…ç»ªæ˜ å°„è¡¨
"""

from typing import List, Tuple
from dataclasses import dataclass


@dataclass
class EmotionMapping:
    """æƒ…ç»ªæ˜ å°„å®ä½“"""
    
    # æƒ…ç»ªæ ‡ç­¾
    traditional: str
    vibe: str
    emoji: str
    color: str
    description: str
    
    # PADèŒƒå›´
    pleasure_range: Tuple[float, float]
    arousal_range: Tuple[float, float]
    dominance_range: Tuple[float, float]
    
    # ç»¼åˆåˆ†æ•°èŒƒå›´
    composite_score_range: Tuple[float, float]
    emotion_type: str  # æƒ…ç»ªç±»å‹ï¼šå…´å¥‹ã€å¿«ä¹ã€æ„¤æ€’ã€ç„¦è™‘ã€æ— èŠã€å¹³é™


class EmotionMappings:
    """æƒ…ç»ªæ˜ å°„é›†åˆ - 26ç§æƒ…ç»ªé‡æ–°åˆ†ä¸º6å¤§ç±»"""
    
    # 6å¤§æƒ…ç»ªåˆ†ç±»å¯¹åº”-100åˆ°100åˆ†çš„6ä¸ªåŒºé—´ï¼ˆåŸºäºPADä¸‰ç»´åº¦ç»¼åˆè¯„åˆ†ï¼‰
    EMOTION_CATEGORIES = {
        "å…´å¥‹": {"range": (80, 100), "color": "#FFD700", "description": "æåº¦ç§¯æå…´å¥‹çŠ¶æ€"},
        "å¿«ä¹": {"range": (40, 79), "color": "#32CD32", "description": "ç§¯ææ„‰æ‚¦çŠ¶æ€"},
        "å¹³é™": {"range": (10, 39), "color": "#4169E1", "description": "ä¸­æ€§å¹³å’ŒçŠ¶æ€"},
        "æ— èŠ": {"range": (-10, 9), "color": "#808080", "description": "ä½å”¤é†’ä¸­æ€§çŠ¶æ€"},
        "ç„¦è™‘": {"range": (-50, -11), "color": "#FF6347", "description": "æ¶ˆæç´§å¼ çŠ¶æ€"},
        "æ„¤æ€’": {"range": (-100, -51), "color": "#DC143C", "description": "é«˜åº¦æ¶ˆæçˆ†å‘çŠ¶æ€"}
    }
    
    MAPPINGS = [
        # ğŸŒŸ å…´å¥‹å–œç±» (80-100åˆ†) - é‡‘è‰²ç³»æ¸å˜ - æéš¾è·å¾—
        EmotionMapping("ç‹‚å–œ", "åŸåœ°å‡å¤©", "ğŸš€", "#FFD700", 
                      "ç°åœ¨çš„æˆ‘å……æ»¡èƒ½é‡âœ¨",
                      (80, 100), (80, 100), (60, 100), (80, 100), "å…´å¥‹"),
        
        EmotionMapping("å…´å¥‹", "é¸¡å«é¢„è­¦", "ğŸ”", "#FFC700", 
                      "å¼€å¿ƒåˆ°é£èµ·ï½",
                      (60, 100), (60, 100), (20, 60), (85, 99), "å…´å¥‹"),
        
        EmotionMapping("éª„å‚²", "å‰è…°ç‚«è€€", "ğŸ¦š", "#FFB000", 
                      "æˆ‘è¶…å‰å®³çš„å¯¹å§ï¼Ÿ",
                      (60, 100), (40, 80), (70, 100), (82, 95), "å…´å¥‹"),
        
        # ğŸ˜Š å¿«ä¹ç±» (40-79åˆ†) - ç»¿è‰²ç³»æ¸å˜ - è¾ƒéš¾è·å¾—
        EmotionMapping("å¼€å¿ƒ", "å˜´è§’AK47", "ğŸ˜", "#32CD32", 
                      "è¿™æ ·çœŸå¥½",
                      (40, 80), (20, 60), (20, 60), (65, 79), "å¿«ä¹"),
        
        EmotionMapping("æ»¡è¶³", "è¢«æ²»æ„ˆäº†", "ğŸ¥¹", "#2ECC71", 
                      "å¥½å¹¸ç¦å‘€...ğŸ’–",
                      (60, 100), (-20, 20), (40, 80), (70, 78), "å¿«ä¹"),
        
        EmotionMapping("æœŸå¾…", "å°é¹¿ä¹±æ’", "ğŸ¦Œ", "#27AE60", 
                      "ç­‰ä¸åŠäº†ï¼",
                      (30, 70), (50, 90), (-20, 20), (60, 74), "å¿«ä¹"),
        
        EmotionMapping("æƒŠå–œ", "ç³å­”åœ°éœ‡", "ğŸ‘ï¸", "#58D68D", 
                      "å“‡ï¼ç»™æˆ‘çš„å—ï¼Ÿ",
                      (30, 70), (60, 100), (-30, 30), (55, 69), "å¿«ä¹"),
        
        EmotionMapping("æ„ŸåŠ¨", "ç ´é˜²äº†", "ğŸ¥º", "#52C41A", 
                      "ä½ çœŸå¥½...",
                      (50, 90), (-10, 30), (30, 70), (45, 64), "å¿«ä¹"),
        
        # ğŸ˜ æ— èŠç±» (-10-9åˆ†) - ç°è‰²ç³»æ¸å˜ - å®¹æ˜“è·å¾—
        EmotionMapping("æ— èŠ", "é•¿è˜‘è‡äº†", "ğŸ„", "#808080", 
                      "é™ªæˆ‘ç©å˜›...",
                      (-30, 30), (-40, 20), (-40, 40), (-5, 9), "æ— èŠ"),
        
        EmotionMapping("å›°æƒ‘", "CPUçƒ§äº†", "ğŸ”¥", "#A9A9A9", 
                      "è¿™æ˜¯å•¥ï¼Ÿ",
                      (-30, 30), (-10, 30), (-50, 0), (-8, 5), "æ— èŠ"),
        
        EmotionMapping("å‘å‘†", "äººé—´ä¸å€¼å¾—", "ğŸ•³ï¸", "#C0C0C0", 
                      "å‘å‘†ä¸­...",
                      (-20, 30), (-30, 20), (-30, 30), (-10, 8), "æ— èŠ"),
        
        EmotionMapping("ç¤¾æ", "ç¤¾æå‘ä½œ", "ğŸ«£", "#D3D3D3", 
                      "åˆ«ç›¯ç€æˆ‘çœ‹å•¦â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„",
                      (-40, 20), (0, 40), (-70, -20), (-6, 6), "æ— èŠ"),
        
        EmotionMapping("å°´å°¬", "è„šè¶¾æŠ åœ°", "ğŸ—ï¸", "#696969", 
                      "åˆ«ç¬‘æˆ‘...",
                      (-30, 10), (30, 70), (-50, -10), (-9, 4), "æ— èŠ"),
        
        # ğŸ˜° ç„¦è™‘ç±» (-50--11åˆ†) - æ©™è‰²ç³»æš—è°ƒ - å®¹æ˜“è·å¾—
        EmotionMapping("ç„¦è™‘", "å¿ƒæ…Œæ…Œ", "ğŸ’”", "#FF6347", 
                      "ä¼šå¥½å—ï¼Ÿ",
                      (-40, 0), (20, 60), (-80, -30), (-45, -12), "ç„¦è™‘"),
        
        EmotionMapping("æ‹…å¿§", "å¦ˆå¦ˆæ‹…å¿ƒ", "ğŸ‘µ", "#FF7F50", 
                      "æ€ä¹ˆåŠ...ğŸ˜°",
                      (-20, 20), (10, 50), (-70, -20), (-40, -15), "ç„¦è™‘"),
        
        EmotionMapping("æ‚²ä¼¤", "æš´é£å“­æ³£", "ğŸ˜­", "#FF4500", 
                      "æŠ±æŠ±æˆ‘...",
                      (-80, -40), (-60, -20), (-80, -20), (-48, -20), "ç„¦è™‘"),
        
        EmotionMapping("æ²®ä¸§", "äººé—´ä¸å€¼å¾—", "ğŸ•³ï¸", "#E74C3C", 
                      "æˆ‘ä¸è¡Œäº†...",
                      (-60, -20), (-40, 0), (-60, -10), (-49, -25), "ç„¦è™‘"),
        
        EmotionMapping("ç–²æƒ«", "ç”µé‡å‘Šæ€¥", "ğŸ”‹", "#CD5C5C", 
                      "è®©æˆ‘æ­‡ä¼š...",
                      (-30, 10), (-80, -40), (-60, -10), (-42, -21), "ç„¦è™‘"),
        
        EmotionMapping("æ‚”æ¨", "è‚ å­æ‚”é’", "ğŸ¥€", "#B22222", 
                      "æˆ‘é”™äº†...ğŸ’”",
                      (-60, -20), (-30, 10), (-70, -20), (-50, -26), "ç„¦è™‘"),
        
        # ğŸ˜Œ å¹³é™ç±» (10-39åˆ†) - è“è‰²ç³»æ¸å˜ - ä¸­ç­‰è·å¾—
        EmotionMapping("å¹³é™", "å²æœˆé™å¥½", "ğŸƒ", "#4169E1", 
                      "è¿™æ ·åˆšå¥½",
                      (20, 60), (-40, 10), (10, 50), (15, 39), "å¹³é™"),
        
        EmotionMapping("æ”¾æ¾", "å·²èººå¹³", "ğŸ›ï¸", "#3498DB", 
                      "å¥½èˆ’æœå‘€ï½",
                      (10, 50), (-60, -20), (20, 60), (20, 38), "å¹³é™"),
        
        EmotionMapping("å¥½å¥‡", "åƒç“œçŠ¶æ€", "ğŸ‰", "#5DADE2", 
                      "è¿™æ˜¯ä»€ä¹ˆå‘€ï¼ŸğŸ¤”",
                      (20, 60), (40, 80), (-20, 20), (12, 35), "å¹³é™"),
        
        EmotionMapping("å®³ç¾", "å°è„¸é€šçº¢", "ğŸ…", "#85C1E9", 
                      "åˆ«çœ‹äººå®¶å•¦",
                      (40, 80), (30, 70), (-70, -20), (11, 28), "å¹³é™"),
        
        # ğŸ˜¡ æ„¤æ€’ç±» (-100--51åˆ†) - çº¢è‰²ç³»æš—è°ƒ - æéš¾è·å¾—
        EmotionMapping("æ„¤æ€’", "åŸåœ°çˆ†ç‚¸", "ğŸ’¥", "#DC143C", 
                      "å¤ªè¿‡åˆ†äº†ï¼ğŸ˜¡",
                      (-100, -40), (50, 100), (40, 100), (-85, -51), "æ„¤æ€’"),
        
        EmotionMapping("ææƒ§", "èƒŒåå‘å‡‰", "ğŸ‘»", "#8B0000", 
                      "åˆ«å“æˆ‘...ğŸ˜¨",
                      (-80, -40), (60, 100), (-100, -50), (-100, -70), "æ„¤æ€’"),
        
        EmotionMapping("æƒŠæ", "å½“åœºå»ä¸–", "âš°ï¸", "#A52A2A", 
                      "æ•‘å‘½ï¼å‘œå‘œ...",
                      (-100, -60), (70, 100), (-100, -60), (-95, -75), "æ„¤æ€’"),
        
        EmotionMapping("çƒ¦èº", "æƒ³éª‚äºº", "ğŸ¤¬", "#FF0000", 
                      "åˆ«åµæˆ‘ï¼",
                      (-60, -20), (30, 70), (-20, 30), (-75, -52), "æ„¤æ€’"),
      ]
    
    @classmethod
    def get_all_mappings(cls) -> List[EmotionMapping]:
        """è·å–æ‰€æœ‰æƒ…ç»ªæ˜ å°„"""
        return cls.MAPPINGS
    
    @classmethod
    def find_matching_emotion(cls, pleasure: float, arousal: float, 
                            dominance: float) -> EmotionMapping:
        """æ ¹æ®PADå€¼æ‰¾åˆ°æœ€åŒ¹é…çš„æƒ…ç»ª"""
        
        def calculate_score(mapping: EmotionMapping) -> float:
            """è®¡ç®—åŒ¹é…åˆ†æ•°ï¼Œåˆ†æ•°è¶Šé«˜è¶ŠåŒ¹é…"""
            
            def in_range_score(value: float, range_tuple: Tuple[float, float]) -> float:
                """è®¡ç®—åœ¨èŒƒå›´å†…çš„åŒ¹é…åˆ†æ•°"""
                min_val, max_val = range_tuple
                if min_val <= value <= max_val:
                    # åœ¨èŒƒå›´å†…ï¼Œè®¡ç®—åˆ°ä¸­å¿ƒç‚¹çš„è·ç¦»ï¼ˆè¶Šæ¥è¿‘ä¸­å¿ƒåˆ†æ•°è¶Šé«˜ï¼‰
                    center = (min_val + max_val) / 2
                    distance = abs(value - center)
                    range_width = max_val - min_val
                    return 1.0 - (distance / (range_width / 2)) * 0.5
                else:
                    # ä¸åœ¨èŒƒå›´å†…ï¼Œè®¡ç®—åˆ°æœ€è¿‘è¾¹ç•Œçš„è·ç¦»
                    if value < min_val:
                        distance = min_val - value
                    else:
                        distance = value - max_val
                    # è·ç¦»è¶Šè¿œï¼Œåˆ†æ•°è¶Šä½
                    return max(0, 1.0 - distance / 50)
            
            # è®¡ç®—ä¸‰ä¸ªç»´åº¦çš„åŒ¹é…åˆ†æ•°
            p_score = in_range_score(pleasure, mapping.pleasure_range)
            a_score = in_range_score(arousal, mapping.arousal_range)
            d_score = in_range_score(dominance, mapping.dominance_range)
            
            # åŠ æƒå¹³å‡ï¼Œä¸emotion_state.pyä¸­çš„æƒé‡ä¿æŒä¸€è‡´
            return (p_score * 0.4 + a_score * 0.35 + d_score * 0.25)
        
        # æ‰¾åˆ°åŒ¹é…åˆ†æ•°æœ€é«˜çš„æƒ…ç»ª
        best_match = max(cls.MAPPINGS, key=calculate_score)
        
        # å¦‚æœæ²¡æœ‰å¥½çš„åŒ¹é…ï¼Œæ ¹æ®æ„‰æ‚¦åº¦è¿›è¡Œå›é€€åŒ¹é…
        if calculate_score(best_match) < 0.3:
            if pleasure >= 60:
                # é«˜æ„‰æ‚¦åº¦ â†’ å¿«ä¹ç±»
                return next(m for m in cls.MAPPINGS if m.traditional == "å¼€å¿ƒ")
            elif pleasure >= 20:
                # ä¸­ç­‰æ„‰æ‚¦åº¦ â†’ å¹³é™ç±»
                return next(m for m in cls.MAPPINGS if m.traditional == "å¹³é™")
            elif pleasure >= -20:
                # ä½æ„‰æ‚¦åº¦ â†’ æ— èŠç±»
                return next(m for m in cls.MAPPINGS if m.traditional == "æ— èŠ")
            elif pleasure >= -50:
                # è´Ÿæ„‰æ‚¦åº¦ â†’ ç„¦è™‘ç±»
                return next(m for m in cls.MAPPINGS if m.traditional == "ç„¦è™‘")
            else:
                # æä½æ„‰æ‚¦åº¦ â†’ æ„¤æ€’ç±»
                return next(m for m in cls.MAPPINGS if m.traditional == "æ„¤æ€’")
        
        return best_match