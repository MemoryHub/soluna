# AI社会模拟系统扩充方案

基于现有代码架构，我为您设计了一个完整的AI社会模拟系统扩充方案，专注于实现角色的生活化事件生成和社会互动。

## 1. 系统架构设计

### 1.1 核心模块
- **角色系统**：现有`Character`类为基础，负责角色属性管理
- **事件系统**：新增模块，负责生成和管理角色的日常事件
- **交互系统**：新增模块，处理角色之间的互动
- **时间系统**：新增模块，模拟时间流逝和周期事件
- **环境系统**：新增模块，定义和管理角色所处的环境
- **记忆系统**：扩展现有记忆功能，强化事件对角色的影响

### 1.2 数据流
```
时间系统 -> 事件系统 -> 角色系统/交互系统 -> 记忆系统 -> 角色系统
                      |
                      v
                  环境系统
```

## 2. 动态角色字段设计

为了让角色真正"活着"，我们需要添加以下动态字段，使角色能够随时间、事件和交互而变化：

### 2.1 状态机相关
用于控制角色当前的心理/行动状态。
```python
current_state: str  # 当前状态，如 '平静', '愤怒', '战斗中', '休息中'
previous_state: str  # 上一个状态，方便状态回退或分析
state_history: List[Dict[str, Any]]  # 状态切换历史，包含时间戳和事件原因
```

### 2.2 情绪系统
跟人格相关，但会动态变化。
```python
current_emotion: str  # 当前主要情绪，如 '开心', '悲伤', '紧张'
emotion_intensity: float  # 情绪强度 0~1
emotion_decay_rate: float  # 情绪衰减速度，受人格影响
emotion_history: List[Dict[str, Any]]  # 记录情绪变化的时间线
```

### 2.3 事件系统
#### 故事线管理器
1.给角色维护一个生活轨迹表
给每个角色维护一个生活轨迹表（例如当前在“大学二年级的暑假”阶段），生成事件时优先参考轨迹表。
```python
模型提示可以是：
当前阶段：大学二年级暑假
最近事件：和朋友去海边
下一步趋势：打工赚钱
请生成一个自然衔接的日常事件。
```
2.关键节点事件
在某些时间点（开学、假期、晋升、搬家等）放“主线事件”，让生活有方向感；其余时间填充“日常事件”。
3.事件依赖关系
给事件打“标签”或“依赖条件”，下一次生成事件时可以要求模型参考依赖关系：
```css
[依赖标签]：已报名马拉松 → 下一步可能是训练、受伤、参赛
```
#### 触发机制
如果简单用定时任务按固定时间跑，就会出现 “集中爆发” 的问题：
同一时间点一大堆角色一起有事件，其他时间就全空。
想让一天中随机角色、随机时间发起事件，就需要一个**事件调度器**来替代单纯的定时任务。
核心思路
上面提到的生活轨迹表
每个角色每天会被分配0~3个潜在事件时间点（随机分布在一天的不同时间）。添加到生活轨迹表中。
到达这些时间点才调用大模型生成事件。

分散化触发：
所有角色的事件时间点都是独立随机生成的 → 不会集中在一个时刻爆发。
调度循环：
每隔一小段时间（例如 5分钟真实时间）扫描一次全体角色：

### 2.4 成长与经验
用于故事线推进和角色变化。
```python
experience_points: int  # 角色当前经验值
level: int  # 等级或阶段
skills: Dict[str, int]  # 技能和等级，如 {'谈判': 3, '战斗': 5}
growth_history: List[str]  # 记录成长节点或人生转折点
character_arc_progress: float  # 成长弧光进度（0~1）
```

### 2.5 关系动态
跟其他角色的关系会随事件变化。
```python
relationships_dynamic: Dict[str, Dict[str, Any]]  
# 例如：
# {
#   '角色ID123': {'亲密度': 70, '信任度': 50, '上次互动': '2025-08-08'},
#   '角色ID456': {'亲密度': 20, '敌意': 80}
# }
```

### 2.6 日程与位置
配合事件系统。
```python
current_activity: str  # 当前正在做的事
location: str  # 角色当前位置
schedule: List[Dict[str, Any]]  # 未来计划（时间、事件、地点）
```

### 2.7 健康与资源
更拟真化。
```python
health: float  # 健康值 0~100
stamina: float  # 体力值
energy: float  # 精力值
resources: Dict[str, Any]  # 物品、金钱等
```

### 2.8 记忆与感知
动态的"角色世界观"更新。
```python
short_term_memory: List[str]  # 最近发生的事
long_term_memory: List[str]  # 核心人生事件
memory_decay_rate: float  # 记忆遗忘速度
perception_bias: Dict[str, float]  # 感知偏差，比如对某类事件更敏感
```

## 3. 详细实现方案