## 🎭 情感系统技术架构（已完善版）

### ✅ 系统实现状态
- **✅ 已完成**: 26种情绪映射配置
- **✅ 已完成**: 说话气泡样式优化
- **✅ 已完成**: 交互动画与气泡显示顺序
- **✅ 已完成**: 情绪描述个性化（带emoji和符号）
- **🔄 进行中**: 三维PAD数值集成

### 三维情绪模型 (PAD)
基于心理学标准的Pleasure-Arousal-Dominance三维情绪模型，每个AI角色拥有真实的情感状态：

**维度定义：**
- **Pleasure（愉悦度）**: -100（极度痛苦）到 +100（极度愉悦）
- **Arousal（激活度/能量值）**: -100（极度疲惫）到 +100（极度兴奋）
- **Dominance（支配感/紧张度）**: -100（完全失控）到 +100（完全掌控）

**PAD权重系数（恒定值）：**
- 愉悦度权重: 40%
- 能量值权重: 35%  
- 支配感权重: 25%

**综合情绪分数计算公式：**
`总分 = (愉悦度×0.4 + 能量值×0.35 + 支配感×0.25)`
*总分范围：-100到+100分*

### 🎯 最新情绪配置表（26种）

| 传统情绪 | 共鸣情绪 | 表情符号 | 颜色 | 愉悦度 | 能量值 | 支配感 | 说话内容 |
|---------|----------|----------|------|--------|--------|--------|----------|
| **🌟 兴奋喜类 (80-100分)** |
| 狂喜 | 原地升天 | 🚀 | #FFD700 | +80~+100 | +80~+100 | +60~+100 | 哇！主人最好啦！✨ |
| 兴奋 | 鸡叫预警 | 🐔 | #FFC700 | +60~+100 | +60~+100 | +20~+60 | 开心到飞起～ |
| 骄傲 | 叉腰炫耀 | 🦚 | #FFB000 | +60~+100 | +40~+80 | +70~+100 | 我超厉害的对吧？ |
| **😊 快乐类 (40-79分)** |
| 开心 | 嘴角AK47 | 😏 | #32CD32 | +40~+80 | +20~+60 | +20~+60 | 这样真好 |
| 满足 | 被治愈了 | 🥹 | #2ECC71 | +60~+100 | -20~+20 | +40~+80 | 好幸福呀...💖 |
| 期待 | 小鹿乱撞 | 🦌 | #27AE60 | +30~+70 | +50~+90 | -20~+20 | 等不及了！ |
| 惊喜 | 瞳孔地震 | 👁️ | #58D68D | +30~+70 | +60~+100 | -30~+30 | 哇！给我的吗？ |
| 感动 | 破防了 | 🥺 | #52C41A | +50~+90 | -10~+30 | +30~+70 | 你真好... |
| **😐 无聊类 (-10-9分)** |
| 无聊 | 长蘑菇了 | 🍄 | #808080 | -20~+20 | -40~+10 | -30~+30 | 陪我玩嘛... |
| 困惑 | CPU烧了 | 🔥 | #A9A9A9 | -30~+30 | -10~+30 | -50~0 | 这是啥？ |
| 发呆 | 人间不值得 | 🕳️ | #C0C0C0 | -20~+30 | -30~+20 | -30~+30 | 发呆中... |
| 社恐 | 社恐发作 | 🫣 | #D3D3D3 | -40~+20 | 0~+40 | -70~-20 | 别盯着我看啦 |
| 尴尬 | 脚趾抠地 | 🏗️ | #696969 | -30~+10 | +30~+70 | -50~-10 | 别笑我... |
| **😰 焦虑类 (-50--11分)** |
| 焦虑 | 心慌慌 | 💔 | #FF6347 | -40~0 | +20~+60 | -80~-30 | 会好吗？ |
| 担忧 | 妈妈担心 | 👵 | #FF7F50 | -20~+20 | +10~+50 | -70~-20 | 怎么办...😰 |
| 悲伤 | 暴风哭泣 | 😭 | #FF4500 | -80~-40 | -60~-20 | -80~-20 | 抱抱我... |
| 沮丧 | 人间不值得 | 🕳️ | #E74C3C | -60~-20 | -40~0 | -60~-10 | 我不行了... |
| 疲惫 | 电量告急 | 🔋 | #CD5C5C | -30~+10 | -80~-40 | -60~-10 | 让我歇会... |
| 悔恨 | 肠子悔青 | 🥀 | #B22222 | -60~-20 | -30~+10 | -70~-20 | 我错了...💔 |
| **😌 平静类 (10-39分)** |
| 平静 | 岁月静好 | 🍃 | #4169E1 | +20~+60 | -40~+10 | +10~+50 | 这样刚好 |
| 放松 | 已躺平 | 🛏️ | #3498DB | +10~+50 | -60~-20 | +20~+60 | 好舒服呀～ |
| 好奇 | 吃瓜状态 | 🍉 | #5DADE2 | +20~+60 | +40~+80 | -20~+20 | 这是什么呀？🤔 |
| 害羞 | 小脸通红 | 🍅 | #85C1E9 | +40~+80 | +30~+70 | -70~-20 | 别看人家啦 |
| **😡 愤怒类 (-100--51分)** |
| 愤怒 | 原地爆炸 | 💥 | #DC143C | -100~-40 | +50~+100 | +40~+100 | 太过分了！😡 |
| 恐惧 | 背后发凉 | 👻 | #8B0000 | -80~-40 | +60~+100 | -100~-50 | 别吓我...😨 |
| 惊恐 | 当场去世 | ⚰️ | #A52A2A | -100~-60 | +70~+100 | -100~-60 | 救命！呜呜... |
| 烦躁 | 想骂人 | 🤬 | #FF0000 | -60~-20 | +30~+70 | -20~+30 | 别吵我！ |

### 🎨 说话气泡优化（已完成）

**位置优化：**
- 说话气泡现在位于角色头部正上方
- 最大宽度90px，支持自动换行
- 居中对齐角色，确保完全在卡片边框内

**显示逻辑：**
- 交互动画播放完成后才显示说话气泡
- 3秒后自动消失，避免干扰
- 支持长文本自动换行，不会超出边界

**个性化内容：**
- **字数变化**：2-9字不等，避免单调
- **emoji装饰**：13个情绪添加了emoji（正好一半）
- **语气符号**：~ ... ！ ？ 等增加鲜活感
- **对话感**：每个都像在回应用户互动

### 🔄 情绪更新机制

#### 1. 实时情绪计算
```javascript
// 基于PAD三维数值获取当前情绪
function getEmotionFromPAD(pleasure, arousal, dominance) {
  const score = pleasure * 0.4 + arousal * 0.35 + dominance * 0.25;
  // 从26种情绪中找到最匹配的配置
  return matchedEmotion; // 包含name, vibe, emoji, color, 说话内容
}
```

#### 2. 触发场景
- **用户互动**：安慰、鼓励、批评等即时更新
- **聊天关键词**：识别用户话语中的情绪词汇
- **生活轨迹**：每15分钟批处理事件影响

#### 3. 情绪影响规则
| 互动类型 | 愉悦度 | 能量值 | 支配感 | 示例说话 |
|----------|--------|--------|--------|----------|
| 安慰一下 | +15 | 0 | -10 | 谢谢主人～ |
| 鼓励加油 | +20 | +10 | -5 | 我会努力的！ |
| 批评责备 | -25 | -10 | +20 | 对不起... |

### 💾 数据存储

#### 当前配置位置
- **情绪映射**：`/src/emotion/model/emotion_mapping.py`
- **说话内容**：已更新为26种个性化短句
- **样式配置**：前端组件已优化显示逻辑

#### 未来扩展
- **历史记录**：记录情绪变化轨迹
- **学习机制**：根据用户偏好调整说话风格
- **情境感知**：结合时间、天气等环境因素

### 🎯 使用示例

#### 前端集成
```javascript
// 获取当前情绪显示
const emotion = getCurrentEmotion();
// 返回：{
//   name: "开心",
//   vibe: "嘴角AK47", 
//   emoji: "😏",
//   color: "#32CD32",
//   speech: "这样真好"
// }

// 显示说话气泡
<CharacterSpeechBubble 
  text={emotion.speech}
  emoji={emotion.emoji}
  color={emotion.color}
/>
```

#### 后端更新
```python
# 更新角色情绪
update_character_emotion(
    character_id="char_001",
    pleasure=+20,  # 用户表扬了角色
    arousal=+10,   # 角色变得活跃
    dominance=-5   # 有点害羞
)
# 会自动计算并显示："喜欢这样～"
```

### 📊 效果展示
- **像素风格**：完美融入16x16像素角色设计
- **动态交互**：动画与对话完美同步
- **个性鲜明**：每种情绪都有独特的表达方式
- **用户友好**：简短有趣的对话增强沉浸感

---

### 🚀 下一步计划
1. **数值集成**：将PAD三维数值接入实际计算
2. **历史追踪**：记录情绪变化曲线
3. **AI学习**：根据用户互动调整说话风格
4. **情境感知**：结合更多环境因素

*最后更新时间：2024年*





